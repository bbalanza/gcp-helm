stages:
  - upload
    
upload:
  stage: upload
  image: 
    name: alpine/helm
    entrypoint: ["/bin/sh", "-c"]
  script:
    - echo "Packaging chart:"
    - helm package . -d ./out
    - echo "Pushing to Artifact Registry"
    - echo $GCP_SERVICE_KEY | helm registry login -u _json_key --password-stdin https://us-central1-docker.pkg.dev
    - helm push ./out/strapi-0.1.0.tgz oci://us-central1-docker.pkg.dev/$GCP_PROJECT_ID/sc-helm